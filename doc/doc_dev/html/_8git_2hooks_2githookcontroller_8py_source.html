<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.6.1"/>
<!--BEGIN PROJECT_NAME--><title>libs3a: libs3a: .git/hooks/githookcontroller.py Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>libs3a: .git/hooks/githookcontroller.py Source File</title><!--END !PROJECT_NAME-->
<link href="$relpath^tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="$relpath^jquery.js"></script>
<script type="text/javascript" src="$relpath^dynsections.js"></script>
$treeview
$search
$mathjax
<link href="$relpath^$stylesheet" rel="stylesheet" type="text/css" />
$extrastylesheet
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="$relpath^$projectlogo"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <div id="projectname">libs3a
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber"></span><!--END PROJECT_NUMBER-->
   </div>
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
    <td style="padding-left: 20.5em;">
      <div> Choose your branch:</div>
  </td>
  <td style="padding-left: .5em;">
      <div align=right><select id="choose_branch">
        <option value="">Change branch</option>
        <option value="http://aachen-3a.github.io/libs3a/doc/doc_master/html/index.html">master</option>
<option value="http://aachen-3a.github.io/libs3a/doc/doc_dev/html/index.html">dev</option>
        </select>
     </div>   
    <script>
        document.getElementById("choose_branch").onchange = function() {
                if (this.selectedIndex!==0) {
                            window.location.href = this.value;
                            //window.open( this.value ); 
                }        
            };
    </script>
  </td>
  <td style="padding-left: 15.5em;">
      <div> Get back to <a href="https://github.com/Aachen-3A/libs3a">GitHub</a></div>
  </td> 
  <td style="padding-left: 0.2em;">
      <div> or </div>
  </td> 
  <td style="padding-left: 0.2em;">
      <div> <a href="https://github.com/Aachen-3A/TAPAS">TAPAS main page</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- end header part -->
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>.git/hooks/githookcontroller.py</h1><a href="_8git_2hooks_2githookcontroller_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespacegithookcontroller.html">00001</a> <span class="comment">#!/usr/bin/env python</span>
<a name="l00002"></a>00002 <span class="comment"># -*- coding: utf-8 -*-</span>
<a name="l00003"></a>00003 <span class="comment">##</span>
<a name="l00004"></a>00004 <span class="comment">## This script contains classes to quickly build own git hooks</span>
<a name="l00005"></a>00005 <span class="comment">## </span>
<a name="l00006"></a>00006 <span class="comment">## Copyright (c) 2014 Tobias Pook</span>
<a name="l00007"></a>00007 <span class="comment">## </span>
<a name="l00008"></a>00008 <span class="comment">## Permission is hereby granted, free of charge, to any person obtaining a copy</span>
<a name="l00009"></a>00009 <span class="comment">## of this software and associated documentation files (the &quot;Software&quot;), to deal</span>
<a name="l00010"></a>00010 <span class="comment">## in the Software without restriction, including without limitation the rights</span>
<a name="l00011"></a>00011 <span class="comment">## to use, copy, modify, merge, publish, distribute, sublicense, and/or sell</span>
<a name="l00012"></a>00012 <span class="comment">## copies of the Software, and to permit persons to whom the Software is</span>
<a name="l00013"></a>00013 <span class="comment">## furnished to do so, subject to the following conditions:</span>
<a name="l00014"></a>00014 <span class="comment">## </span>
<a name="l00015"></a>00015 <span class="comment">## The above copyright notice and this permission notice shall be included in</span>
<a name="l00016"></a>00016 <span class="comment">## all copies or substantial portions of the Software.</span>
<a name="l00017"></a>00017 <span class="comment">## </span>
<a name="l00018"></a>00018 <span class="comment">## THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR</span>
<a name="l00019"></a>00019 <span class="comment">## IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,</span>
<a name="l00020"></a>00020 <span class="comment">## FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE</span>
<a name="l00021"></a>00021 <span class="comment">## AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER</span>
<a name="l00022"></a>00022 <span class="comment">## LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,</span>
<a name="l00023"></a>00023 <span class="comment">## OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN</span>
<a name="l00024"></a>00024 <span class="comment">## THE SOFTWARE.</span>
<a name="l00025"></a>00025 
<a name="l00026"></a>00026 <span class="keyword">import</span> sys, os
<a name="l00027"></a>00027 <span class="keyword">import</span> shutil
<a name="l00028"></a>00028 <span class="keyword">from</span>  collections <span class="keyword">import</span> namedtuple
<a name="l00029"></a>00029 <span class="keyword">import</span> parser
<a name="l00030"></a>00030 <span class="keyword">import</span> argparse
<a name="l00031"></a>00031 <span class="keyword">import</span> subprocess
<a name="l00032"></a>00032 <span class="keyword">import</span> logging
<a name="l00033"></a>00033 <span class="keyword">import</span> urllib2
<a name="l00034"></a>00034 
<a name="l00035"></a><a class="code" href="namespacegithookcontroller.html#a07fe3d473709d295bc9fe30eae4b8796">00035</a> log = logging.getLogger( <span class="stringliteral">&apos;githookcontroller&apos;</span> )
<a name="l00036"></a>00036 log.setLevel( logging.INFO )
<a name="l00037"></a><a class="code" href="namespacegithookcontroller.html#a129c3321b595523639202014a8f9c09f">00037</a> ch = logging.StreamHandler( sys.stdout )
<a name="l00038"></a>00038 ch.setLevel( logging.INFO )
<a name="l00039"></a><a class="code" href="namespacegithookcontroller.html#ac71a8430a2ef0ed0fc2ecc8dc8c7c9d0">00039</a> formatter = logging.Formatter( <span class="stringliteral">&apos;%(levelname)s (%(name)s): %(message)s&apos;</span> )
<a name="l00040"></a>00040 ch.setFormatter( formatter )
<a name="l00041"></a>00041 log.addHandler( ch )
<a name="l00042"></a>00042 
<a name="l00043"></a><a class="code" href="namespacegithookcontroller.html#a390dabc9c7e7699add5a906c8f823c0e">00043</a> Push = namedtuple(<span class="stringliteral">&apos;Push&apos;</span>, [<span class="stringliteral">&apos;commits&apos;</span>, <span class="stringliteral">&apos;remote_name&apos;</span>, <span class="stringliteral">&apos;remote_url&apos;</span>,
<a name="l00044"></a>00044                            <span class="stringliteral">&apos;current_branch&apos;</span>, <span class="stringliteral">&apos;removing_remote&apos;</span>, <span class="stringliteral">&apos;forcing&apos;</span>])
<a name="l00045"></a><a class="code" href="namespacegithookcontroller.html#a7e506c5052d0d2cb99595ab7f5973f38">00045</a> Commit = namedtuple(<span class="stringliteral">&apos;Commit&apos;</span>, [<span class="stringliteral">&apos;local_ref&apos;</span>, <span class="stringliteral">&apos;local_sha1&apos;</span>, <span class="stringliteral">&apos;remote_ref&apos;</span>, <span class="stringliteral">&apos;remote_sha1&apos;</span>,
<a name="l00046"></a>00046                                <span class="stringliteral">&apos;local_branch&apos;</span>, <span class="stringliteral">&apos;remote_branch&apos;</span>])
<a name="l00047"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html">00047</a> <span class="keyword">class </span><a class="code" href="classgithookcontroller_1_1GitHookController.html">GitHookController</a>():
<a name="l00048"></a>00048     
<a name="l00049"></a>00049     <span class="comment">## The constructor.</span>
<a name="l00050"></a>00050     <span class="comment">#</span>
<a name="l00051"></a>00051     <span class="comment"># @param self The object pointer</span>
<a name="l00052"></a>00052     <span class="comment"># @param tempdir Directory where files are stored temporarily outside the repo default: /tmp/</span>
<a name="l00053"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a7f1f9bd109cc2853afd4e2723e21d850">00053</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a7f1f9bd109cc2853afd4e2723e21d850" title="The constructor.">__init__</a>(self, tempdir = &apos;/tmp/&apos;):
<a name="l00054"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a0a7652159b00048328dd294d66121320">00054</a>         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a0a7652159b00048328dd294d66121320">args</a> = <span class="keywordtype">None</span>
<a name="l00055"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#ab6260e9264f723f80240836b5b40b7be">00055</a>         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#ab6260e9264f723f80240836b5b40b7be">stdin</a> = []
<a name="l00056"></a>00056         parser = argparse.ArgumentParser(description=<span class="stringliteral">&apos;Parser for git message to hook&apos;</span>)
<a name="l00057"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a6f0514a65c6a463b7281560600f779e3">00057</a>         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a6f0514a65c6a463b7281560600f779e3">parser</a> = parser
<a name="l00058"></a>00058         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#ab6260e9264f723f80240836b5b40b7be">stdin</a> = sys.stdin.read()
<a name="l00059"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a06fd053bc960e412ddbcd4629b76c538">00059</a>         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a06fd053bc960e412ddbcd4629b76c538">organisation</a> = <span class="stringliteral">&apos;aachen-3a&apos;</span>
<a name="l00060"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#aac7b1a1ad3f8b04d222284318682e458">00060</a>         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#aac7b1a1ad3f8b04d222284318682e458">tempdir</a> = tempdir
<a name="l00061"></a>00061         <span class="comment"># list of branches where branch specific hooks are ignored</span>
<a name="l00062"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#af93cd1ba98b94f200cd7f56d637b53b0">00062</a>         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#af93cd1ba98b94f200cd7f56d637b53b0">vetobranches</a> = [<span class="stringliteral">&apos;gh-pages&apos;</span>]
<a name="l00063"></a>00063         <span class="comment"># list of reponametags (parts of repo root name) where doxygen</span>
<a name="l00064"></a>00064         <span class="comment"># documentation is enforced</span>
<a name="l00065"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a2533cf4e8ad615f1b225790bb4cb9a40">00065</a>         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a2533cf4e8ad615f1b225790bb4cb9a40">doxy_enforce_repos</a> = [<span class="stringliteral">&apos;lib&apos;</span>, <span class="stringliteral">&apos;Lib&apos;</span>,<span class="stringliteral">&apos;test&apos;</span>]
<a name="l00066"></a>00066         
<a name="l00067"></a>00067     
<a name="l00068"></a>00068     <span class="comment">############################</span>
<a name="l00069"></a>00069     <span class="comment">### git helper functions ###</span>
<a name="l00070"></a>00070     <span class="comment">############################</span>
<a name="l00071"></a>00071     
<a name="l00072"></a>00072     <span class="comment">## Get root name of repo</span>
<a name="l00073"></a>00073     <span class="comment">#</span>
<a name="l00074"></a>00074     <span class="comment"># @returns string containing the name of the root name</span>
<a name="l00075"></a>00075     @property
<a name="l00076"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a8a5c26241b0be9a8db1167075135fc17">00076</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a8a5c26241b0be9a8db1167075135fc17" title="Get root name of repo.">root_name</a>(self):
<a name="l00077"></a>00077         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;rev-parse&quot;</span>,<span class="stringliteral">&quot;--show-toplevel&quot;</span>]
<a name="l00078"></a>00078         cmd = [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00079"></a>00079         stdout = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>).communicate()[0].rstrip()
<a name="l00080"></a>00080         <span class="keywordflow">return</span> stdout.split(<span class="stringliteral">&apos;/&apos;</span>)[-1]
<a name="l00081"></a>00081     
<a name="l00082"></a>00082     <span class="comment">## Get root name of remote (the original repo name) </span>
<a name="l00083"></a>00083     <span class="comment">#</span>
<a name="l00084"></a>00084     <span class="comment"># @returns string containing the name of the remote root name</span>
<a name="l00085"></a>00085     @property
<a name="l00086"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a0c1fed60080eae8ba4ca0a216aac236e">00086</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a0c1fed60080eae8ba4ca0a216aac236e" title="Get root name of remote (the original repo name).">remote_root_name</a>(self):
<a name="l00087"></a>00087         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;remote&quot;</span>,<span class="stringliteral">&quot;-v&quot;</span>]
<a name="l00088"></a>00088         cmd = [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00089"></a>00089         stdout = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>).communicate()[0].rstrip().split(<span class="stringliteral">&apos;\n&apos;</span>)
<a name="l00090"></a>00090         <span class="comment">#~ print stdout</span>
<a name="l00091"></a>00091         <span class="keywordflow">for</span> line <span class="keywordflow">in</span> stdout:
<a name="l00092"></a>00092             <span class="keywordflow">if</span> <span class="stringliteral">&apos;fetch&apos;</span> <span class="keywordflow">in</span> line:
<a name="l00093"></a>00093                 <span class="keywordflow">if</span> <span class="stringliteral">&apos;https&apos;</span> <span class="keywordflow">in</span> line:
<a name="l00094"></a>00094                     <span class="keywordflow">return</span> line.split( <span class="stringliteral">&apos;/&apos;</span> )[-1].replace( <span class="stringliteral">&apos;.git&apos;</span>, <span class="stringliteral">&apos;&apos;</span> ).replace( <span class="stringliteral">&apos;(fetch)&apos;</span>, <span class="stringliteral">&apos;&apos;</span> ).strip()
<a name="l00095"></a>00095                 <span class="keywordflow">if</span> <span class="stringliteral">&apos;git@github.com&apos;</span> <span class="keywordflow">in</span> line:
<a name="l00096"></a>00096                     <span class="keywordflow">return</span> line.split( <span class="stringliteral">&apos;/&apos;</span> )[-1].replace( <span class="stringliteral">&apos;.git&apos;</span>, <span class="stringliteral">&apos;&apos;</span> ).replace( <span class="stringliteral">&apos;(fetch)&apos;</span>, <span class="stringliteral">&apos;&apos;</span> ).strip()
<a name="l00097"></a>00097         <span class="keywordflow">return</span> <span class="stringliteral">&apos;not_found&apos;</span>
<a name="l00098"></a>00098         
<a name="l00099"></a>00099     <span class="comment">## Get url from remote </span>
<a name="l00100"></a>00100     <span class="comment">#</span>
<a name="l00101"></a>00101     <span class="comment"># @returns string containing the name of the remote root name</span>
<a name="l00102"></a>00102     @property
<a name="l00103"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a5a1bc7a8f626bfadf24ea70b9fbc35a9">00103</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a5a1bc7a8f626bfadf24ea70b9fbc35a9" title="Get url from remote.">remote_url</a>(self):
<a name="l00104"></a>00104         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;remote&quot;</span>,<span class="stringliteral">&quot;-v&quot;</span>]
<a name="l00105"></a>00105         cmd = [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00106"></a>00106         proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00107"></a>00107         stdout = proc.communicate()[0].rstrip().split(<span class="stringliteral">&apos;\n&apos;</span>)
<a name="l00108"></a>00108         <span class="comment">#~ print stdout</span>
<a name="l00109"></a>00109         <span class="keywordflow">for</span> line <span class="keywordflow">in</span> stdout:
<a name="l00110"></a>00110             <span class="keywordflow">if</span> <span class="stringliteral">&apos;fetch&apos;</span> <span class="keywordflow">in</span> line:
<a name="l00111"></a>00111 
<a name="l00112"></a>00112                 <span class="keywordflow">if</span> <span class="stringliteral">&apos;https&apos;</span> <span class="keywordflow">in</span> line:
<a name="l00113"></a>00113                     url = line.split()[1].replace( <span class="stringliteral">&apos;.git&apos;</span>, <span class="stringliteral">&apos;&apos;</span> )
<a name="l00114"></a>00114                     url = url.replace( <span class="stringliteral">&apos;(fetch)&apos;</span>, <span class="stringliteral">&apos;&apos;</span> ).strip()
<a name="l00115"></a>00115                 <span class="keywordflow">if</span> <span class="stringliteral">&apos;git@&apos;</span> <span class="keywordflow">in</span> line:
<a name="l00116"></a>00116                     url = line.split( <span class="stringliteral">&apos;@&apos;</span> )[-1]
<a name="l00117"></a>00117                     url = url.replace( <span class="stringliteral">&apos;.git&apos;</span>, <span class="stringliteral">&apos;&apos;</span> )
<a name="l00118"></a>00118                     url = url.replace( <span class="stringliteral">&apos;(fetch)&apos;</span>, <span class="stringliteral">&apos;&apos;</span> ).strip()
<a name="l00119"></a>00119                     url = url.replace( <span class="stringliteral">&apos;:&apos;</span>, <span class="stringliteral">&apos;/&apos;</span> ).strip()
<a name="l00120"></a>00120                     url = <span class="stringliteral">&quot;https://&quot;</span> + url 
<a name="l00121"></a>00121                     
<a name="l00122"></a>00122                 <span class="keywordflow">try</span>:
<a name="l00123"></a>00123                     urllib2.urlopen(url)
<a name="l00124"></a>00124                     <span class="keywordflow">return</span> url
<a name="l00125"></a>00125                 <span class="keywordflow">except</span> urllib2.HTTPError, e:
<a name="l00126"></a>00126                     <span class="keywordflow">return</span> <span class="stringliteral">&quot;HTTPerror url nor found %s&quot;</span> % e.args
<a name="l00127"></a>00127                 <span class="keywordflow">except</span> urllib2.URLError, e:
<a name="l00128"></a>00128                     <span class="keywordflow">return</span> <span class="stringliteral">&quot;URLerror url nor found %s&quot;</span> % e.args
<a name="l00129"></a>00129                 <span class="keywordflow">except</span> :
<a name="l00130"></a>00130                     <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>
<a name="l00131"></a>00131         <span class="keywordflow">return</span> <span class="stringliteral">&quot;&quot;</span>
<a name="l00132"></a>00132     
<a name="l00133"></a>00133     <span class="comment">## Get currently chosen branch </span>
<a name="l00134"></a>00134     <span class="comment">#</span>
<a name="l00135"></a>00135     @property
<a name="l00136"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4">00136</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a>(self):
<a name="l00137"></a>00137         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;branch&quot;</span>, <span class="stringliteral">&quot;|&quot;</span>, <span class="stringliteral">&quot;sed -n -e &apos;s/^\\* \\(.*\)/\\1/p&apos;&quot;</span>]
<a name="l00138"></a>00138         cmd = [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00139"></a>00139         stdout = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>).communicate()[0].rstrip()
<a name="l00140"></a>00140         <span class="keywordflow">return</span> stdout
<a name="l00141"></a>00141     
<a name="l00142"></a>00142     <span class="comment">## Get list of remote branches </span>
<a name="l00143"></a>00143     <span class="comment">#</span>
<a name="l00144"></a>00144     <span class="comment"># @returns A list of strings containing all remot branch names</span>
<a name="l00145"></a>00145     @property
<a name="l00146"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a67ee09f9a24f3033e5aa200a1f85a254">00146</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a67ee09f9a24f3033e5aa200a1f85a254" title="Get list of remote branches.">remote_branches</a>(self):
<a name="l00147"></a>00147         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;branch&quot;</span>, <span class="stringliteral">&quot;-r&quot;</span>]
<a name="l00148"></a>00148         cmd = [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00149"></a>00149         stdout = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>).communicate()[0].rstrip().split(<span class="stringliteral">&apos;\n&apos;</span>)
<a name="l00150"></a>00150         stdout = [ st.split(<span class="stringliteral">&apos;/&apos;</span>)[-1] <span class="keywordflow">for</span> st <span class="keywordflow">in</span> stdout]
<a name="l00151"></a>00151         branches = list( set(stdout) )
<a name="l00152"></a>00152         <span class="keywordflow">return</span> stdout
<a name="l00153"></a>00153         
<a name="l00154"></a>00154     <span class="comment">## Checkout another branch </span>
<a name="l00155"></a>00155     <span class="comment">#</span>
<a name="l00156"></a>00156     <span class="comment"># @param self The object pointer</span>
<a name="l00157"></a>00157     <span class="comment"># @param branchname name of branch which is checked out </span>
<a name="l00158"></a>00158     <span class="comment"># @param forced boolean for forced checkout </span>
<a name="l00159"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#aba2b2ca683888b5814fd843d1b5947f0">00159</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#aba2b2ca683888b5814fd843d1b5947f0" title="Checkout another branch.">checkout_branch</a>(self, branchname, forced = False):
<a name="l00160"></a>00160         <span class="keywordflow">if</span> forced: flag = <span class="stringliteral">&apos;-f&apos;</span>
<a name="l00161"></a>00161         <span class="keywordflow">else</span>: flag = <span class="stringliteral">&apos;&apos;</span>
<a name="l00162"></a>00162         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;checkout&quot;</span>, branchname,flag]
<a name="l00163"></a>00163         cmd = [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00164"></a>00164         proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00165"></a>00165         stdout = proc.communicate()[0].rstrip()
<a name="l00166"></a>00166     
<a name="l00167"></a>00167     <span class="comment">###########################</span>
<a name="l00168"></a>00168     <span class="comment">### functions for hooks ###</span>
<a name="l00169"></a>00169     <span class="comment">###########################</span>
<a name="l00170"></a>00170     
<a name="l00171"></a>00171     <span class="comment">## Parse message from post commit</span>
<a name="l00172"></a>00172     <span class="comment">#</span>
<a name="l00173"></a>00173     <span class="comment"># @param self The object pointer</span>
<a name="l00174"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a8adc94fcccb274990be0f8f02282ea9c">00174</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a8adc94fcccb274990be0f8f02282ea9c" title="Parse message from post commit.">post_commit</a>(self):
<a name="l00175"></a>00175         <span class="keywordflow">pass</span>
<a name="l00176"></a>00176         
<a name="l00177"></a>00177     <span class="comment">## Get list of chagend files in commit</span>
<a name="l00178"></a>00178     <span class="comment">#</span>
<a name="l00179"></a>00179     <span class="comment"># @param self The object pointer</span>
<a name="l00180"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a00105512abe2fb01ae83626942f786d5">00180</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a00105512abe2fb01ae83626942f786d5" title="Get list of chagend files in commit.">parse_pre_commit</a>(self):
<a name="l00181"></a>00181         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;diff&quot;</span>, <span class="stringliteral">&quot;--cached&quot;</span>, <span class="stringliteral">&quot;--name-status&quot;</span>]            
<a name="l00182"></a>00182         cmd = [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00183"></a>00183         proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00184"></a>00184         files = proc.communicate()[0].rstrip().split(<span class="stringliteral">&apos;\n&apos;</span>)
<a name="l00185"></a>00185         <span class="keywordflow">try</span>:
<a name="l00186"></a>00186             files = [(f.split(<span class="stringliteral">&apos;\t&apos;</span>)[0] , f.split(<span class="stringliteral">&apos;\t&apos;</span>)[1] ) <span class="keywordflow">for</span> f <span class="keywordflow">in</span> files]
<a name="l00187"></a>00187         <span class="keywordflow">except</span>:
<a name="l00188"></a>00188             files = []
<a name="l00189"></a>00189         <span class="keywordflow">return</span> files
<a name="l00190"></a>00190         
<a name="l00191"></a>00191     <span class="comment">## Parse message from pre-push </span>
<a name="l00192"></a>00192     <span class="comment">#</span>
<a name="l00193"></a>00193     <span class="comment"># Based on example in:</span>
<a name="l00194"></a>00194     <span class="comment"># http://axialcorps.com/2014/06/03/preventing-errant-git-pushes-with-a-pre-push-hook/</span>
<a name="l00195"></a>00195     <span class="comment">#</span>
<a name="l00196"></a>00196     <span class="comment"># @param self The object pointer</span>
<a name="l00197"></a>00197     <span class="comment"># @returns namedtupe of type Push fields: [&apos;commits&apos;, &apos;remote_name&apos;, &apos;remote_url&apos;,&apos;current_branch&apos;, &apos;removing_remote&apos;, &apos;forcing&apos;]</span>
<a name="l00198"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a4cfebeaebb015c7b37ff8aad264bf6dd">00198</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a4cfebeaebb015c7b37ff8aad264bf6dd" title="Parse message from pre-push.">parse_pre_push</a>(self):
<a name="l00199"></a>00199         commits = []
<a name="l00200"></a>00200         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a6f0514a65c6a463b7281560600f779e3">parser</a>.add_argument(<span class="stringliteral">&apos;remote_name&apos;</span>)
<a name="l00201"></a>00201         self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a6f0514a65c6a463b7281560600f779e3">parser</a>.add_argument(<span class="stringliteral">&apos;remote_url&apos;</span>)
<a name="l00202"></a>00202         args = self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a6f0514a65c6a463b7281560600f779e3">parser</a>.parse_args()
<a name="l00203"></a>00203         lines = self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#ab6260e9264f723f80240836b5b40b7be">stdin</a>.splitlines()
<a name="l00204"></a>00204         <span class="keywordflow">for</span> line <span class="keywordflow">in</span> lines:
<a name="l00205"></a>00205             split_line = line.split()
<a name="l00206"></a>00206             <span class="keywordflow">if</span> len(split_line) != 4:
<a name="l00207"></a>00207                 self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a6f0514a65c6a463b7281560600f779e3">parser</a>.exit(status=1,
<a name="l00208"></a>00208                             message=<span class="stringliteral">&quot;Could not parse commit from &apos;{}&apos;\n&quot;</span>.format(line))
<a name="l00209"></a>00209             <span class="comment"># local_branch</span>
<a name="l00210"></a>00210             local_branch = split_line[0].split(<span class="stringliteral">&apos;/&apos;</span>)[-1] <span class="keywordflow">if</span> <span class="stringliteral">&apos;/&apos;</span> <span class="keywordflow">in</span> split_line[0] <span class="keywordflow">else</span> <span class="keywordtype">None</span>
<a name="l00211"></a>00211             split_line.append(local_branch)
<a name="l00212"></a>00212             <span class="comment"># remote_branch</span>
<a name="l00213"></a>00213             remote_branch = split_line[2].split(<span class="stringliteral">&apos;/&apos;</span>)[-1] <span class="keywordflow">if</span> <span class="stringliteral">&apos;/&apos;</span> <span class="keywordflow">in</span> split_line[2] <span class="keywordflow">else</span> <span class="keywordtype">None</span>
<a name="l00214"></a>00214             split_line.append(remote_branch)
<a name="l00215"></a>00215             commits.append(Commit(*split_line))
<a name="l00216"></a>00216         current_ref = subprocess.Popen([<span class="stringliteral">&apos;git&apos;</span>, <span class="stringliteral">&apos;symbolic-ref&apos;</span>, <span class="stringliteral">&apos;HEAD&apos;</span>],
<a name="l00217"></a>00217                                         stdout=subprocess.PIPE).communicate()[0]
<a name="l00218"></a>00218         current_branch = current_ref.split(<span class="stringliteral">&apos;/&apos;</span>)[-1]
<a name="l00219"></a>00219         pid = os.getppid()
<a name="l00220"></a>00220         push_command = subprocess.Popen([<span class="stringliteral">&apos;ps&apos;</span>, <span class="stringliteral">&apos;-ocommand=&apos;</span>, <span class="stringliteral">&apos;-p&apos;</span>,
<a name="l00221"></a>00221                                         str(pid)],
<a name="l00222"></a>00222                                         stdout=subprocess.PIPE).communicate()[0]
<a name="l00223"></a>00223         forcing = (<span class="stringliteral">&apos;--force&apos;</span> <span class="keywordflow">in</span> push_command <span class="keywordflow">or</span> <span class="stringliteral">&apos;-f&apos;</span> <span class="keywordflow">in</span> push_command)
<a name="l00224"></a>00224         removing_remote = set()
<a name="l00225"></a>00225         <span class="keywordflow">for</span> commit <span class="keywordflow">in</span> commits:
<a name="l00226"></a>00226             <span class="keywordflow">if</span> commit.local_ref == <span class="stringliteral">&quot;(delete)&quot;</span>:
<a name="l00227"></a>00227                 removing_remote.add(commit.remote_branch)
<a name="l00228"></a>00228                 
<a name="l00229"></a>00229         <span class="keywordflow">return</span> Push(commits=commits,
<a name="l00230"></a>00230                     remote_name=args.remote_name, 
<a name="l00231"></a>00231                     remote_url=args.remote_url,
<a name="l00232"></a>00232                     current_branch=current_branch,
<a name="l00233"></a>00233                     removing_remote=removing_remote,
<a name="l00234"></a>00234                     forcing=forcing)
<a name="l00235"></a>00235     
<a name="l00236"></a>00236     <span class="comment">###########################################</span>
<a name="l00237"></a>00237     <span class="comment">### functions for code style enforcment ###</span>
<a name="l00238"></a>00238     <span class="comment">###########################################</span>
<a name="l00239"></a>00239     
<a name="l00240"></a>00240     <span class="comment">## Check if file fullfills cpplint check</span>
<a name="l00241"></a>00241     <span class="comment">#</span>
<a name="l00242"></a>00242     <span class="comment"># @param self The object pointer</span>
<a name="l00243"></a>00243     <span class="comment"># @param filepath path to the file where lint check should be performed </span>
<a name="l00244"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a99707bfcd7e2a5bc3c58fa57c8bb40b7">00244</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a99707bfcd7e2a5bc3c58fa57c8bb40b7" title="Check if file fullfills cpplint check.">check_cpplint</a>( self, filepath):
<a name="l00245"></a>00245         <span class="keywordflow">pass</span>
<a name="l00246"></a>00246         
<a name="l00247"></a>00247     <span class="comment">#########################################</span>
<a name="l00248"></a>00248     <span class="comment">### functions for doxygen integration ###</span>
<a name="l00249"></a>00249     <span class="comment">#########################################</span>
<a name="l00250"></a>00250     
<a name="l00251"></a>00251     <span class="comment">## Prepare doxygen config file from template</span>
<a name="l00252"></a>00252     <span class="comment">#</span>
<a name="l00253"></a>00253     <span class="comment"># The function replaces Tokens for files in ./doc/:</span>
<a name="l00254"></a>00254     <span class="comment"># - template_cfg</span>
<a name="l00255"></a>00255     <span class="comment">#   available Tokens:</span>
<a name="l00256"></a>00256     <span class="comment">#     %branchname% current branch name</span>
<a name="l00257"></a>00257     <span class="comment">#     %remote_root_name%</span>
<a name="l00258"></a>00258     <span class="comment">#     %html_header% path to html header file</span>
<a name="l00259"></a>00259     <span class="comment">#     %html_footer% path to html header file</span>
<a name="l00260"></a>00260     <span class="comment"># - header_template.html</span>
<a name="l00261"></a>00261     <span class="comment"># - footer_template.html</span>
<a name="l00262"></a>00262     <span class="comment">#   available Tokens:</span>
<a name="l00263"></a>00263     <span class="comment">#      +++optionsline+++ a fixed url path </span>
<a name="l00264"></a>00264     <span class="comment">#      ++branch_name++ current branch name</span>
<a name="l00265"></a>00265     <span class="comment">#      ++remote_url++ see object property</span>
<a name="l00266"></a>00266     <span class="comment">#      ++remote_root_name++ see object property</span>
<a name="l00267"></a>00267     <span class="comment"># </span>
<a name="l00268"></a>00268     <span class="comment"># @param self The object pointer</span>
<a name="l00269"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#adbf9eaec761c0834c4e260eb38eb44a1">00269</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#adbf9eaec761c0834c4e260eb38eb44a1" title="Prepare doxygen config file from template.">prepare_doxygen_cfg</a>(self):
<a name="l00270"></a>00270         <span class="keywordflow">if</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> <span class="keywordflow">in</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#af93cd1ba98b94f200cd7f56d637b53b0">vetobranches</a>:
<a name="l00271"></a>00271             <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00272"></a>00272             
<a name="l00273"></a>00273         <span class="comment">## prepare footer.html and header.html</span>
<a name="l00274"></a>00274         template_html = {}
<a name="l00275"></a>00275         header_template_path = <span class="stringliteral">&apos;./doc/header_template.html&apos;</span>
<a name="l00276"></a>00276         footer_template_path = <span class="stringliteral">&apos;./doc/footer_template.html&apos;</span>
<a name="l00277"></a>00277         
<a name="l00278"></a>00278         <span class="comment"># check if template files exist and read</span>
<a name="l00279"></a>00279         <span class="keywordflow">if</span> os.path.isfile( header_template_path ):
<a name="l00280"></a>00280             header_path = <span class="stringliteral">&apos;./doc/header.html&apos;</span>
<a name="l00281"></a>00281             with open( header_template_path, <span class="stringliteral">&quot;rU+&quot;</span>) <span class="keyword">as</span> header_template:
<a name="l00282"></a>00282                 header_html = header_template.read()
<a name="l00283"></a>00283                 template_html.update({<span class="stringliteral">&apos;header&apos;</span> : header_html } )
<a name="l00284"></a>00284         <span class="keywordflow">else</span>: 
<a name="l00285"></a>00285             header_path = <span class="stringliteral">&apos;&apos;</span>
<a name="l00286"></a>00286             
<a name="l00287"></a>00287         <span class="keywordflow">if</span> os.path.isfile( footer_template_path ):
<a name="l00288"></a>00288             doFooter = <span class="keyword">True</span>
<a name="l00289"></a>00289             footer_path = <span class="stringliteral">&apos;./doc/footer.html&apos;</span>
<a name="l00290"></a>00290             with open( footer_template_path , <span class="stringliteral">&quot;rU+&quot;</span>) <span class="keyword">as</span> footer_template:
<a name="l00291"></a>00291                 footer_html = footer_template.read()
<a name="l00292"></a>00292                 template_html.update( {<span class="stringliteral">&apos;footer&apos;</span>:footer_html} )
<a name="l00293"></a>00293         <span class="keywordflow">else</span>: 
<a name="l00294"></a>00294             footer_path = <span class="stringliteral">&apos;&apos;</span>
<a name="l00295"></a>00295             
<a name="l00296"></a>00296         <span class="comment"># prepare linklines and replacements</span>
<a name="l00297"></a>00297         linklines = []
<a name="l00298"></a>00298         <span class="keywordflow">for</span> branchname <span class="keywordflow">in</span> list( set(self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a67ee09f9a24f3033e5aa200a1f85a254" title="Get list of remote branches.">remote_branches</a>) ):
<a name="l00299"></a>00299             <span class="keywordflow">if</span> branchname <span class="keywordflow">in</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#af93cd1ba98b94f200cd7f56d637b53b0">vetobranches</a>:
<a name="l00300"></a>00300                <span class="keywordflow">continue</span> 
<a name="l00301"></a>00301             <span class="keywordflow">print</span> ( self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a06fd053bc960e412ddbcd4629b76c538">organisation</a>, self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a0c1fed60080eae8ba4ca0a216aac236e" title="Get root name of remote (the original repo name).">remote_root_name</a>, branchname , branchname)
<a name="l00302"></a>00302             linkline = <span class="stringliteral">&apos;&lt;option value=&quot;http://%s.github.io/%s/doc/doc_%s/html/index.html&quot;&gt;%s&lt;/option&gt;&apos;</span> % \
<a name="l00303"></a>00303                         ( self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a06fd053bc960e412ddbcd4629b76c538">organisation</a>, self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a0c1fed60080eae8ba4ca0a216aac236e" title="Get root name of remote (the original repo name).">remote_root_name</a>, branchname, branchname)
<a name="l00304"></a>00304                         
<a name="l00305"></a>00305             linklines.append( linkline )
<a name="l00306"></a>00306         
<a name="l00307"></a>00307         replacements = { <span class="stringliteral">&apos;++branchname++&apos;</span> : self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a>,
<a name="l00308"></a>00308                          <span class="stringliteral">&apos;++remote_root_name++&apos;</span> : self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a0c1fed60080eae8ba4ca0a216aac236e" title="Get root name of remote (the original repo name).">remote_root_name</a>,    
<a name="l00309"></a>00309                          <span class="stringliteral">&apos;++remote_url++&apos;</span> : self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a5a1bc7a8f626bfadf24ea70b9fbc35a9" title="Get url from remote.">remote_url</a> }
<a name="l00310"></a>00310         
<a name="l00311"></a>00311         <span class="comment"># replace tokens and write files</span>
<a name="l00312"></a>00312         <span class="keywordflow">for</span> key <span class="keywordflow">in</span> template_html.keys():
<a name="l00313"></a>00313             text = template_html[key]   
<a name="l00314"></a>00314             text = text.replace( <span class="stringliteral">&apos;+++optionsline+++&apos;</span>, <span class="stringliteral">&apos;\n&apos;</span>.join( linklines ) )   
<a name="l00315"></a>00315             <span class="keywordflow">for</span> src, target <span class="keywordflow">in</span> replacements.iteritems():
<a name="l00316"></a>00316                 text = text.replace(src, target)
<a name="l00317"></a>00317             with open( <span class="stringliteral">&apos;./doc/%s.html&apos;</span> % key, <span class="stringliteral">&quot;wb&quot;</span> ) <span class="keyword">as</span> html_file:
<a name="l00318"></a>00318                 html_file.write( text )  
<a name="l00319"></a>00319         
<a name="l00320"></a>00320         <span class="comment">## prepare main config    </span>
<a name="l00321"></a>00321         replacements = { <span class="stringliteral">&apos;%branchname%&apos;</span>:self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a>,
<a name="l00322"></a>00322                          <span class="stringliteral">&apos;%remote_root_name%&apos;</span> : self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a0c1fed60080eae8ba4ca0a216aac236e" title="Get root name of remote (the original repo name).">remote_root_name</a>,
<a name="l00323"></a>00323                          <span class="stringliteral">&apos;%footer_html%&apos;</span> : footer_path,
<a name="l00324"></a>00324                          <span class="stringliteral">&apos;%header_html%&apos;</span> : header_path }
<a name="l00325"></a>00325         with open(<span class="stringliteral">&apos;./doc/doxy_cfg_template&apos;</span>, <span class="stringliteral">&quot;rU+&quot;</span>) <span class="keyword">as</span> template:
<a name="l00326"></a>00326             text = template.read()
<a name="l00327"></a>00327             <span class="keywordflow">for</span> src, target <span class="keywordflow">in</span> replacements.iteritems():
<a name="l00328"></a>00328                     text = text.replace(src, target)
<a name="l00329"></a>00329                     
<a name="l00330"></a>00330         with open(<span class="stringliteral">&apos;./doc/doxy_cfg&apos;</span>, <span class="stringliteral">&quot;wb&quot;</span>) <span class="keyword">as</span> config:
<a name="l00331"></a>00331             config.write(text)
<a name="l00332"></a>00332     
<a name="l00333"></a>00333     <span class="comment">## Checkout all doygen folders in gh-pages branch and commit changes</span>
<a name="l00334"></a>00334     <span class="comment">#</span>
<a name="l00335"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#ad9a2f3aae9911b167daf5323ca000e5f">00335</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#ad9a2f3aae9911b167daf5323ca000e5f" title="Checkout all doygen folders in gh-pages branch and commit changes.">publish_doxygen</a>( self, branchnames ):
<a name="l00336"></a>00336         branchnames = list(set(branchnames))
<a name="l00337"></a>00337         startbranch = self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a>
<a name="l00338"></a>00338         <span class="keywordflow">if</span> len(branchnames) &gt; 0:
<a name="l00339"></a>00339             <span class="comment"># check if current branch is in branchnames and process it first to</span>
<a name="l00340"></a>00340             <span class="comment"># avoid uneccessary git checkouts</span>
<a name="l00341"></a>00341             <span class="keywordflow">if</span> any(self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> <span class="keywordflow">in</span> b <span class="keywordflow">for</span> b <span class="keywordflow">in</span> branchnames):
<a name="l00342"></a>00342                 branchnames.remove( self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> )
<a name="l00343"></a>00343                 branchnames.insert( 0, self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> )
<a name="l00344"></a>00344                 
<a name="l00345"></a>00345             <span class="keywordflow">if</span> <span class="keywordflow">not</span> <span class="stringliteral">&apos;gh-pages&apos;</span> <span class="keywordflow">in</span> branchnames:
<a name="l00346"></a>00346                 <span class="comment"># checkout gh-pages branch, move and add folders</span>
<a name="l00347"></a>00347                 self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#aba2b2ca683888b5814fd843d1b5947f0" title="Checkout another branch.">checkout_branch</a>( <span class="stringliteral">&apos;gh-pages&apos;</span> )
<a name="l00348"></a>00348                 <span class="comment"># make sure gh-pages is up to date</span>
<a name="l00349"></a>00349                 cmd = [ <span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;pull&quot;</span>]
<a name="l00350"></a>00350                 proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00351"></a>00351                 stdout = proc.communicate()[0].rstrip()
<a name="l00352"></a>00352                 branchnames = list( set(branchnames) )
<a name="l00353"></a>00353                 <span class="comment">#checkout doc folders from all branches</span>
<a name="l00354"></a>00354                 <span class="keywordflow">for</span> branchname <span class="keywordflow">in</span> branchnames:
<a name="l00355"></a>00355                     log.debug( <span class="stringliteral">&apos;adding doc for %s to gh-pages&apos;</span> % branchname )
<a name="l00356"></a>00356                     cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;checkout&quot;</span>, branchname, <span class="stringliteral">&quot;./doc/doc_%s&quot;</span> % branchname]
<a name="l00357"></a>00357                     cmd = <span class="stringliteral">&apos; &apos;</span>.join(cmd)
<a name="l00358"></a>00358                     log.debug( cmd )
<a name="l00359"></a>00359                     proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00360"></a>00360                     <span class="comment">#~ proc = subprocess.Popen(cmd,stdout=subprocess.PIPE)</span>
<a name="l00361"></a>00361                     stdout = proc.communicate()[0].rstrip()
<a name="l00362"></a>00362                     log.debug( stdout )
<a name="l00363"></a>00363                     
<a name="l00364"></a>00364                     <span class="comment"># add checked out files</span>
<a name="l00365"></a>00365                     cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;add&quot;</span>, <span class="stringliteral">&quot;./doc/doc_%s&quot;</span> % branchname]
<a name="l00366"></a>00366                     cmd = <span class="stringliteral">&apos; &apos;</span>.join( cmd ) 
<a name="l00367"></a>00367                     log.debug( cmd )
<a name="l00368"></a>00368                     proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00369"></a>00369                     <span class="comment">#~ proc = subprocess.Popen(cmd,stdout=subprocess.PIPE)</span>
<a name="l00370"></a>00370                     stdout = proc.communicate()[0].rstrip()
<a name="l00371"></a>00371                     log.debug( stdout )
<a name="l00372"></a>00372                  <span class="comment"># commit changes </span>
<a name="l00373"></a>00373                 bname = <span class="stringliteral">&apos; &apos;</span>.join( branchnames )
<a name="l00374"></a>00374                 msg = <span class="stringliteral">&apos;&quot; updated doxygen documentation for branch: %s&quot;&apos;</span> % bname
<a name="l00375"></a>00375                 cmd = [ <span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;commit&quot;</span>, <span class="stringliteral">&quot;-a&quot;</span> ,<span class="stringliteral">&quot;--no-verify&quot;</span>, <span class="stringliteral">&quot;-m&quot;</span> , msg]
<a name="l00376"></a>00376                 cmd =  [<span class="stringliteral">&apos; &apos;</span>.join(cmd)]
<a name="l00377"></a>00377                 log.debug( cmd )
<a name="l00378"></a>00378                 <span class="comment">#~ print cmd</span>
<a name="l00379"></a>00379                 proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00380"></a>00380                 stdout = proc.communicate()[0].rstrip()
<a name="l00381"></a>00381                 log.info( stdout )
<a name="l00382"></a>00382                 
<a name="l00383"></a>00383                 <span class="comment"># push only gh-branches as it is not included in current push</span>
<a name="l00384"></a>00384                 cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;push&quot;</span>, <span class="stringliteral">&quot;--no-verify&quot;</span> ,<span class="stringliteral">&quot;origin&quot;</span>, <span class="stringliteral">&quot;gh-pages&quot;</span>]
<a name="l00385"></a>00385                 cmd = <span class="stringliteral">&apos; &apos;</span>.join(cmd)
<a name="l00386"></a>00386                 log.debug( cmd )
<a name="l00387"></a>00387                 log.debug( <span class="stringliteral">&apos;pushing in gh-pages&apos;</span>)
<a name="l00388"></a>00388                 <span class="comment">#~ proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=True)</span>
<a name="l00389"></a>00389                 proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00390"></a>00390                 stdout = proc.communicate()[0].rstrip()
<a name="l00391"></a>00391                 log.debug( stdout )
<a name="l00392"></a>00392                 <span class="comment"># return to start branch</span>
<a name="l00393"></a>00393                 self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#aba2b2ca683888b5814fd843d1b5947f0" title="Checkout another branch.">checkout_branch</a>( startbranch )
<a name="l00394"></a>00394            
<a name="l00395"></a>00395     <span class="comment">## Update the doxygen documentation for this folder repo</span>
<a name="l00396"></a>00396     <span class="comment">#</span>
<a name="l00397"></a>00397     <span class="comment"># Based on example in:</span>
<a name="l00398"></a>00398     <span class="comment"># http://axialcorps.com/2014/06/03/preventing-errant-git-pushes-with-a-pre-push-hook/</span>
<a name="l00399"></a>00399     <span class="comment">#</span>
<a name="l00400"></a>00400     <span class="comment"># @param self The object pointer</span>
<a name="l00401"></a>00401     <span class="comment"># @param configpath Path to the doxygen confi file</span>
<a name="l00402"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#aa0aeb33121078a6af7a478dd3baae2e9">00402</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#aa0aeb33121078a6af7a478dd3baae2e9" title="Update the doxygen documentation for this folder repo.">update_doxygen</a>(self,configpath = &apos;./doc/doxy_cfg&apos;):
<a name="l00403"></a>00403         <span class="keywordflow">if</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> <span class="keywordflow">in</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#af93cd1ba98b94f200cd7f56d637b53b0">vetobranches</a>:
<a name="l00404"></a>00404             <span class="keywordflow">return</span> <span class="keywordtype">None</span>
<a name="l00405"></a>00405         log.info( <span class="stringliteral">&apos;updating doxygen documentation&apos;</span> )
<a name="l00406"></a>00406         stdout, stderr = current_ref = subprocess.Popen([<span class="stringliteral">&apos;doxygen&apos;</span>, configpath],
<a name="l00407"></a>00407                                         stdout=subprocess.PIPE).communicate()
<a name="l00408"></a>00408         warnings = self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a988b64d673e16e7afe7b943abc6a6f28" title="Get all doxygen warnings.">_get_doxygen_warnings</a>()
<a name="l00409"></a>00409         nwarnings = len(warnings)
<a name="l00410"></a>00410         <span class="keywordflow">if</span> nwarnings &gt; 0:
<a name="l00411"></a>00411             log.warning(<span class="stringliteral">&apos;Doxyen produced %d warnings, please check in ./doc/doxy.warn&apos;</span> % nwarnings)
<a name="l00412"></a>00412             log.info(<span class="stringliteral">&apos;Everybody will love you for great documentation !&apos;</span>)
<a name="l00413"></a>00413             
<a name="l00414"></a>00414             <span class="comment"># check if doxgen should be enforced</span>
<a name="l00415"></a>00415             
<a name="l00416"></a>00416             <span class="keywordflow">if</span> any(b <span class="keywordflow">in</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a8a5c26241b0be9a8db1167075135fc17" title="Get root name of repo.">root_name</a> <span class="keywordflow">for</span> b <span class="keywordflow">in</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a2533cf4e8ad615f1b225790bb4cb9a40">doxy_enforce_repos</a>) :
<a name="l00417"></a>00417                 log.warning( <span class="stringliteral">&apos;Working in repo %s, please take special care of documentation and fix all doxgen warnings before commit.&apos;</span> % self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a8a5c26241b0be9a8db1167075135fc17" title="Get root name of repo.">root_name</a>)
<a name="l00418"></a>00418                 <span class="keywordflow">if</span> self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> <span class="keywordflow">in</span> <span class="stringliteral">&apos;dev&apos;</span>  <span class="keywordflow">or</span>  self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> <span class="keywordflow">in</span> <span class="stringliteral">&apos;master&apos;</span> :
<a name="l00419"></a>00419                     log.error( <span class="stringliteral">&apos;You are in branch %s. Doxygen documention is enforced here! No commit until doxy.warn is empty&apos;</span> % self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a>)
<a name="l00420"></a>00420                     log.info( <span class="stringliteral">&apos;\n&apos;</span>.join(warnings) )
<a name="l00421"></a>00421                     sys.exit(1)
<a name="l00422"></a>00422                 <span class="keywordflow">else</span>:
<a name="l00423"></a>00423                     log.warning( <span class="stringliteral">&apos;You are in branch %s. Better fix errors now or merge commits will be rejected to dev/master in the future&apos;</span> )
<a name="l00424"></a>00424         <span class="comment"># add new doc to branch</span>
<a name="l00425"></a>00425         cmd = [ <span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;add&quot;</span>, <span class="stringliteral">&quot;doc/doc_%s/&quot;</span> % self.<a class="code" href="classgithookcontroller_1_1GitHookController.html#a43652a52f41cb499383f8a78fdabb7e4" title="Get currently chosen branch.">current_branch</a> ]
<a name="l00426"></a>00426         <span class="keywordflow">print</span> cmd
<a name="l00427"></a>00427         proc = subprocess.Popen(cmd,stdout=subprocess.PIPE)
<a name="l00428"></a>00428         stdout = proc.communicate()[0].rstrip()
<a name="l00429"></a>00429         cmd = [<span class="stringliteral">&quot;git&quot;</span>, <span class="stringliteral">&quot;commit&quot;</span>, <span class="stringliteral">&quot;-a&quot;</span>, <span class="stringliteral">&quot;--amend&quot;</span>, <span class="stringliteral">&quot;-C&quot;</span>, <span class="stringliteral">&quot;HEAD&quot;</span>, <span class="stringliteral">&quot;--no-verify&quot;</span>]
<a name="l00430"></a>00430         proc = subprocess.Popen(cmd,stdout=subprocess.PIPE,shell=<span class="keyword">True</span>)
<a name="l00431"></a>00431         stdout = proc.communicate()[0].rstrip()
<a name="l00432"></a>00432 
<a name="l00433"></a>00433 
<a name="l00434"></a>00434     <span class="comment">## Get all doxygen warnings</span>
<a name="l00435"></a>00435     <span class="comment">#</span>
<a name="l00436"></a><a class="code" href="classgithookcontroller_1_1GitHookController.html#a988b64d673e16e7afe7b943abc6a6f28">00436</a>     <span class="keyword">def </span><a class="code" href="classgithookcontroller_1_1GitHookController.html#a988b64d673e16e7afe7b943abc6a6f28" title="Get all doxygen warnings.">_get_doxygen_warnings</a>(self):
<a name="l00437"></a>00437         doxy_warn_path = <span class="stringliteral">&apos;./doc/doxy.warn&apos;</span>
<a name="l00438"></a>00438         <span class="keywordflow">if</span> os.path.exists(doxy_warn_path):
<a name="l00439"></a>00439             with open( doxy_warn_path ) <span class="keyword">as</span> warnfile:
<a name="l00440"></a>00440                 warnings = warnfile.readlines()
<a name="l00441"></a>00441             <span class="keywordflow">return</span> warnings
<a name="l00442"></a>00442         <span class="keywordflow">else</span>:
<a name="l00443"></a>00443             <span class="keywordflow">return</span> []
<a name="l00444"></a>00444     
<a name="l00445"></a>00445 <span class="comment">#~ for line in fileinput.input(&quot;test.txt&quot;, inplace=True):</span>
<a name="l00446"></a>00446     <span class="comment">#~ print &quot;%d: %s&quot; % (fileinput.filelineno(), line),</span>
<a name="l00447"></a>00447 <span class="comment">#~ def </span>
<a name="l00448"></a>00448 <span class="comment">#~ sed &apos;s/foo/bar/g&apos;</span>
<a name="l00449"></a>00449 <span class="comment">#~ git log --format=%B -n 1 &lt;commit&gt;</span>
<a name="l00450"></a>00450 <span class="keyword">def </span><a class="code" href="namespacegithookcontroller.html#a6a5ae319fc1dddba4b5b5574726be71e">main</a>():
<a name="l00451"></a>00451     <span class="keywordflow">pass</span>
<a name="l00452"></a>00452     <span class="comment">#~ print lines</span>
<a name="l00453"></a>00453     <span class="comment">#~ newpush = assemble_push( args, lines )</span>
<a name="l00454"></a>00454     <span class="comment">#~ print newpush</span>
<a name="l00455"></a>00455     <span class="comment">#~ gitController = GitHookController()</span>
<a name="l00456"></a>00456     <span class="comment">#~ push = gitController.parse_pre_push()</span>
<a name="l00457"></a>00457     <span class="comment">#~ print push</span>
<a name="l00458"></a>00458 
<a name="l00459"></a>00459 <span class="keywordflow">if</span> __name__==<span class="stringliteral">&quot;__main__&quot;</span>:
<a name="l00460"></a>00460     main()
<a name="l00461"></a>00461 
<a name="l00462"></a>00462     
</pre></div></div>
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    $navpath
    <li class="footer">
      libs3a is part of TAPAS check out all parts of it on 
      <a href="https://github.com/Aachen-3A/TAPAS">github</a>.
      Documentation $generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="$relpath^doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
  </ul>

</div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>

$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="$relpath^doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
