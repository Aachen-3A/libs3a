<!-- HTML header for doxygen 1.8.5-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.6.1"/>
<!--BEGIN PROJECT_NAME--><title>libs3a: libs3a: examples/cesubmit/specialAna/remote_example.py Source File</title><!--END PROJECT_NAME-->
<!--BEGIN !PROJECT_NAME--><title>libs3a: examples/cesubmit/specialAna/remote_example.py Source File</title><!--END !PROJECT_NAME-->
<link href="$relpath^tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="$relpath^jquery.js"></script>
<script type="text/javascript" src="$relpath^dynsections.js"></script>
$treeview
$search
$mathjax
<link href="$relpath^$stylesheet" rel="stylesheet" type="text/css" />
$extrastylesheet
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->

<!--BEGIN TITLEAREA-->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <!--BEGIN PROJECT_LOGO-->
  <td id="projectlogo"><img alt="Logo" src="$relpath^$projectlogo"/></td>
  <!--END PROJECT_LOGO-->
  <!--BEGIN PROJECT_NAME-->
  <td style="padding-left: 0.5em;">
   <div id="projectname">libs3a
   <!--BEGIN PROJECT_NUMBER-->&#160;<span id="projectnumber"></span><!--END PROJECT_NUMBER-->
   </div>
   <!--BEGIN PROJECT_BRIEF--><div id="projectbrief">$projectbrief</div><!--END PROJECT_BRIEF-->
  </td>
  <!--END PROJECT_NAME-->
  <!--BEGIN !PROJECT_NAME-->
   <!--BEGIN PROJECT_BRIEF-->
    <td style="padding-left: 0.5em;">
    <div id="projectbrief">$projectbrief</div>
    </td>
   <!--END PROJECT_BRIEF-->
  <!--END !PROJECT_NAME-->
  <!--BEGIN DISABLE_INDEX-->
   <!--BEGIN SEARCHENGINE-->
   <td>$searchbox</td>
   <!--END SEARCHENGINE-->
  <!--END DISABLE_INDEX-->
    <td style="padding-left: 20.5em;">
      <div> Choose your branch:</div>
  </td>
  <td style="padding-left: .5em;">
      <div align=right><select id="choose_branch">
        <option value="">Change branch</option>
        <option value="http://aachen-3a.github.io/libs3a/doc/doc_master/html/index.html">master</option>
<option value="http://aachen-3a.github.io/libs3a/doc/doc_dev/html/index.html">dev</option>
        </select>
     </div>   
    <script>
        document.getElementById("choose_branch").onchange = function() {
                if (this.selectedIndex!==0) {
                            window.location.href = this.value;
                            //window.open( this.value ); 
                }        
            };
    </script>
  </td>
  <td style="padding-left: 15.5em;">
      <div> Get back to <a href="https://github.com/Aachen-3A/libs3a">GitHub</a></div>
  </td> 
  <td style="padding-left: 0.2em;">
      <div> or </div>
  </td> 
  <td style="padding-left: 0.2em;">
      <div> <a href="https://github.com/Aachen-3A/TAPAS">TAPAS main page</a></div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!--END TITLEAREA-->
<!-- end header part -->
<!-- Generated by Doxygen 1.6.1 -->
<div class="navigation" id="top">
  <div class="tabs">
    <ul>
      <li><a href="main.html"><span>Main&nbsp;Page</span></a></li>
      <li><a href="pages.html"><span>Related&nbsp;Pages</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
    </ul>
  </div>
  <div class="tabs">
    <ul>
      <li><a href="files.html"><span>File&nbsp;List</span></a></li>
      <li><a href="globals.html"><span>File&nbsp;Members</span></a></li>
    </ul>
  </div>
<h1>examples/cesubmit/specialAna/remote_example.py</h1><a href="remote__example_8py.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a><a class="code" href="namespaceremote__example.html">00001</a> <span class="comment">#&gt;/bin/env python</span>
<a name="l00002"></a>00002 <span class="keyword">import</span> sys
<a name="l00003"></a>00003 <span class="keyword">import</span> cesubmit
<a name="l00004"></a>00004 <span class="keyword">from</span> listFiles <span class="keyword">import</span> getdcachelist
<a name="l00005"></a>00005 <span class="keyword">import</span> binConfig_example <span class="keyword">as</span> binConfig
<a name="l00006"></a>00006 <span class="keyword">import</span> checkEnvironment
<a name="l00007"></a>00007 <span class="keyword">from</span> datetime <span class="keyword">import</span> datetime
<a name="l00008"></a>00008 <span class="keyword">import</span> optparse,os,time,cPickle,subprocess,shutil
<a name="l00009"></a>00009 <span class="keyword">import</span> logging
<a name="l00010"></a><a class="code" href="namespaceremote__example.html#aa37f61ec4f5e880b2b6609ae8a2e097a">00010</a> log = logging.getLogger( <span class="stringliteral">&apos;remote&apos;</span> )
<a name="l00011"></a>00011 
<a name="l00012"></a><a class="code" href="namespaceremote__example.html#abb915c82f8bb0b9e228034bdedf08d0d">00012</a> <span class="keyword">def </span><a class="code" href="namespaceremote__example.html#abb915c82f8bb0b9e228034bdedf08d0d">getFilesfromFile</a>(cfgFile):
<a name="l00013"></a>00013     sampleList={}
<a name="l00014"></a>00014     file = open(cfgFile,<span class="stringliteral">&apos;</span><span class="stringliteral">r&apos;)</span>
<a name="l00015"></a>00015 <span class="stringliteral">    user,tag,sample,config=[</span><span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>,<span class="stringliteral">&quot;&quot;</span>]
<a name="l00016"></a>00016 
<a name="l00017"></a>00017     known_folders=dict()
<a name="l00018"></a>00018     <span class="keywordflow">if</span> <span class="keywordflow">not</span> os.path.exists(<span class="stringliteral">&quot;data&quot;</span>):
<a name="l00019"></a>00019         os.mkdir(<span class="stringliteral">&quot;data&quot;</span>)
<a name="l00020"></a>00020 
<a name="l00021"></a>00021     <span class="keywordflow">if</span> os.path.exists(<span class="stringliteral">&quot;data/fileList.pkl&quot;</span>):
<a name="l00022"></a>00022         known_folders=readDcachePickle(<span class="stringliteral">&quot;data/fileList.pkl&quot;</span>)
<a name="l00023"></a>00023 
<a name="l00024"></a>00024     <span class="keywordflow">for</span> line <span class="keywordflow">in</span> file:
<a name="l00025"></a>00025         <span class="keywordflow">if</span> <span class="stringliteral">&quot;tag=&quot;</span> <span class="keywordflow">in</span> line:
<a name="l00026"></a>00026             tag=line.split(<span class="stringliteral">&quot;=&quot;</span>)[1].strip()
<a name="l00027"></a>00027             <span class="keywordflow">continue</span>
<a name="l00028"></a>00028         <span class="keywordflow">if</span> <span class="stringliteral">&quot;user=&quot;</span> <span class="keywordflow">in</span> line:
<a name="l00029"></a>00029             user=line.split(<span class="stringliteral">&quot;=&quot;</span>)[1].strip()
<a name="l00030"></a>00030             <span class="keywordflow">continue</span>
<a name="l00031"></a>00031         <span class="keywordflow">if</span> <span class="stringliteral">&quot;config=&quot;</span> <span class="keywordflow">in</span> line:
<a name="l00032"></a>00032             config=line.split(<span class="stringliteral">&quot;=&quot;</span>)[1].strip()
<a name="l00033"></a>00033             <span class="keywordflow">continue</span>
<a name="l00034"></a>00034         <span class="keywordflow">if</span> line[0]==<span class="stringliteral">&quot;#&quot;</span> <span class="keywordflow">or</span> len(line.split())==0:
<a name="l00035"></a>00035             <span class="keywordflow">continue</span>
<a name="l00036"></a>00036         sample=line.strip()
<a name="l00037"></a>00037         log.debug( <span class="stringliteral">&quot; &quot;</span>.join([user,tag,sample,config]))
<a name="l00038"></a>00038         folder=<span class="stringliteral">&quot;/%s/MUSiC/%s/%s&quot;</span> % (user,tag,sample)
<a name="l00039"></a>00039         <span class="keywordflow">if</span> folder <span class="keywordflow">in</span> known_folders:
<a name="l00040"></a>00040             file_lists=known_folders[folder]
<a name="l00041"></a>00041         <span class="keywordflow">else</span>:
<a name="l00042"></a>00042             time.sleep(4)
<a name="l00043"></a>00043             file_lists = getdcachelist( folder,sample )
<a name="l00044"></a>00044             outfile = open( <span class="stringliteral">&quot;data/fileList.pkl&quot;</span>, <span class="stringliteral">&apos;a+b&apos;</span> )
<a name="l00045"></a>00045             cPickle.dump( {folder:file_lists}, outfile, -1 )
<a name="l00046"></a>00046             outfile.close()
<a name="l00047"></a>00047 
<a name="l00048"></a>00048         <span class="keywordflow">if</span> len(file_lists)&gt;0:
<a name="l00049"></a>00049             sampleList.update({sample:[file_lists,config]})
<a name="l00050"></a>00050         <span class="keywordflow">else</span>:
<a name="l00051"></a>00051             <span class="keywordflow">raise</span> IOError( <span class="stringliteral">&apos;No sample in List for folder &apos;</span>+sample )
<a name="l00052"></a>00052     <span class="keywordflow">return</span> sampleList
<a name="l00053"></a>00053 
<a name="l00054"></a><a class="code" href="namespaceremote__example.html#a7b1abe8533a97d62e1645e3a8341edc8">00054</a> <span class="keyword">def </span><a class="code" href="namespaceremote__example.html#a7b1abe8533a97d62e1645e3a8341edc8">readDcachePickle</a>(file):
<a name="l00055"></a>00055     infile = open(file, <span class="stringliteral">&apos;rb&apos;</span> )
<a name="l00056"></a>00056     known_folders = dict()
<a name="l00057"></a>00057     <span class="keywordflow">try</span>:
<a name="l00058"></a>00058         <span class="keywordflow">while</span> <span class="keyword">True</span>:
<a name="l00059"></a>00059             <span class="keywordflow">try</span>:
<a name="l00060"></a>00060                 folder = cPickle.load( infile )
<a name="l00061"></a>00061                 known_folders.update( folder )
<a name="l00062"></a>00062             <span class="keywordflow">except</span> KeyError <span class="keyword">as</span> e:
<a name="l00063"></a>00063                 log.error( <span class="stringliteral">&quot;KeyError: &quot;</span>+e)
<a name="l00064"></a>00064             <span class="keywordflow">except</span> IndexError <span class="keyword">as</span> e:
<a name="l00065"></a>00065                 log.error( <span class="stringliteral">&quot;IndexError: &quot;</span>+e)
<a name="l00066"></a>00066                 infile.close()
<a name="l00067"></a>00067                 <span class="keywordflow">return</span> known_folders
<a name="l00068"></a>00068             <span class="keywordflow">except</span> cPickle.UnpicklingError <span class="keyword">as</span> e:
<a name="l00069"></a>00069                 log.error( <span class="stringliteral">&quot;cPickle.UnpicklingError: &quot;</span>+e)
<a name="l00070"></a>00070                 infile.close()
<a name="l00071"></a>00071                 <span class="keywordflow">return</span> known_folders
<a name="l00072"></a>00072             <span class="keywordflow">except</span> ValueError <span class="keyword">as</span> e:
<a name="l00073"></a>00073                 log.error( <span class="stringliteral">&quot;ValueError: &quot;</span>+e)
<a name="l00074"></a>00074     <span class="keywordflow">except</span> EOFError:
<a name="l00075"></a>00075         infile.close()
<a name="l00076"></a>00076         <span class="keywordflow">return</span> known_folders
<a name="l00077"></a>00077     <span class="keywordflow">except</span>:
<a name="l00078"></a>00078         <span class="keywordflow">raise</span>
<a name="l00079"></a>00079 
<a name="l00080"></a><a class="code" href="namespaceremote__example.html#a5b1acc66737728a685a78ab4ab948f51">00080</a> <span class="keyword">def </span><a class="code" href="namespaceremote__example.html#a5b1acc66737728a685a78ab4ab948f51">makeExe</a>(user):
<a name="l00081"></a>00081     <span class="keyword">from</span> string <span class="keyword">import</span> Template
<a name="l00082"></a>00082     exe=<span class="stringliteral">&quot;&quot;&quot;</span>
<a name="l00083"></a>00083 <span class="stringliteral">    echo Copying pack...</span>
<a name="l00084"></a>00084 <span class="stringliteral">    #Try 10 times to copy the pack file with help of srmcp.</span>
<a name="l00085"></a>00085 <span class="stringliteral">    success=false</span>
<a name="l00086"></a>00086 <span class="stringliteral">    for i in {1..10}; do</span>
<a name="l00087"></a>00087 <span class="stringliteral">       if srmcp gsiftp://grid-se113.physik.rwth-aachen.de:2811/pnfs/physik.rwth-aachen.de/cms/store/user/$USER/$PROGAM/share/program.tar.gz file:///.; then</span>
<a name="l00088"></a>00088 <span class="stringliteral">          success=true</span>
<a name="l00089"></a>00089 <span class="stringliteral">          break</span>
<a name="l00090"></a>00090 <span class="stringliteral">       fi</span>
<a name="l00091"></a>00091 <span class="stringliteral">    done</span>
<a name="l00092"></a>00092 <span class="stringliteral">    if ! $success; then</span>
<a name="l00093"></a>00093 <span class="stringliteral">       echo Copying of pack file \\\&apos;gsiftp://grid-se113.physik.rwth-aachen.de:2811/pnfs/physik.rwth-aachen.de/cms/store/user/$USER/$PROGAM/share/program.tar.gz\\\&apos; failed! 1&gt;&amp;2</span>
<a name="l00094"></a>00094 <span class="stringliteral">       echo Did you forget to \\\&apos;remix --copy\\\&apos;? 1&gt;&amp;2</span>
<a name="l00095"></a>00095 <span class="stringliteral">    fi</span>
<a name="l00096"></a>00096 <span class="stringliteral"></span>
<a name="l00097"></a>00097 <span class="stringliteral"></span>
<a name="l00098"></a>00098 <span class="stringliteral">    tar xzvf program.tar.gz</span>
<a name="l00099"></a>00099 <span class="stringliteral">    export MUSIC_BASE=$PWD</span>
<a name="l00100"></a>00100 <span class="stringliteral">    export LD_LIBRARY_PATH=$PWD/extra_libs:$LD_LIBRARY_PATH</span>
<a name="l00101"></a>00101 <span class="stringliteral">    export LD_LIBRARY_PATH=$LHAPATHREPLACE/lib:$LD_LIBRARY_PATH</span>
<a name="l00102"></a>00102 <span class="stringliteral">    #echo LD_LIBRARY_PATH=$LD_LIBRARY_PATH</span>
<a name="l00103"></a>00103 <span class="stringliteral">    #echo Setting LHAPATH to $LHAPATHREPLACE</span>
<a name="l00104"></a>00104 <span class="stringliteral">    export LHAPATH=$LHAPATHREPLACE2</span>
<a name="l00105"></a>00105 <span class="stringliteral"></span>
<a name="l00106"></a>00106 <span class="stringliteral">    ldd bin/music</span>
<a name="l00107"></a>00107 <span class="stringliteral">    echo &quot;$@&quot;</span>
<a name="l00108"></a>00108 <span class="stringliteral">    bin/music &quot;$@&quot;</span>
<a name="l00109"></a>00109 <span class="stringliteral"></span>
<a name="l00110"></a>00110 <span class="stringliteral">    tar czf MusicOutDir.tar.gz MusicOutDir&quot;&quot;&quot;</span>
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 
<a name="l00113"></a>00113     <span class="comment">#this should be done as a fuction parameter</span>
<a name="l00114"></a>00114     d = dict(
<a name="l00115"></a>00115             USER=user,
<a name="l00116"></a>00116             PROGAM=<span class="stringliteral">&quot;MUSiC&quot;</span>,
<a name="l00117"></a>00117             LHAPATHREPLACE=<span class="stringliteral">&quot;/cvmfs/cms.cern.ch/slc6_amd64_gcc481/external/lhapdf6/6.1.4/&quot;</span>,
<a name="l00118"></a>00118             LHAPATHREPLACE2=<span class="stringliteral">&quot;/cvmfs/cms.cern.ch/slc6_amd64_gcc481/external/lhapdf6/6.1.4/share/LHAPDF/PDFsets&quot;</span>,
<a name="l00119"></a>00119         )
<a name="l00120"></a>00120     exe=Template(exe).safe_substitute(d)
<a name="l00121"></a>00121     exeFile=open(<span class="stringliteral">&quot;runtemp.sh&quot;</span>,<span class="stringliteral">&quot;w+&quot;</span>)
<a name="l00122"></a>00122     exeFile.write(exe)
<a name="l00123"></a>00123     exeFile.close()
<a name="l00124"></a>00124 
<a name="l00125"></a><a class="code" href="namespaceremote__example.html#a68ce292cef03837e69a6cf682d40718a">00125</a> <span class="keyword">def </span><a class="code" href="namespaceremote__example.html#a68ce292cef03837e69a6cf682d40718a">prepare_teli</a>(options):
<a name="l00126"></a>00126     <span class="keyword">import</span> tempfile
<a name="l00127"></a>00127     <span class="keyword">import</span> TimedCall
<a name="l00128"></a>00128     log.info(<span class="stringliteral">&quot;Copy file to dache..&quot;</span>)
<a name="l00129"></a>00129     cpFiles=binConfig.cpFiles
<a name="l00130"></a>00130     PathtoExecutable=binConfig.PathtoExecutable
<a name="l00131"></a>00131     tempdir = tempfile.mkdtemp( prefix=<span class="stringliteral">&apos;televisionExe-&apos;</span> )
<a name="l00132"></a>00132     <span class="keywordflow">for</span> i <span class="keywordflow">in</span> cpFiles:
<a name="l00133"></a>00133         command=<span class="stringliteral">&quot;cp -r %s/%s %s&quot;</span>%(PathtoExecutable,i,tempdir)
<a name="l00134"></a>00134         retcode, output2=TimedCall.retry(3,300,command.split(<span class="stringliteral">&quot; &quot;</span>))
<a name="l00135"></a>00135         <span class="keywordflow">if</span> retcode!=0:
<a name="l00136"></a>00136             log.error(<span class="stringliteral">&quot;Could not create a local copy check arguments!!&quot;</span>)
<a name="l00137"></a>00137             sys.exit(1)
<a name="l00138"></a>00138     thidir=os.getcwd()
<a name="l00139"></a>00139     os.chdir( tempdir )
<a name="l00140"></a>00140 
<a name="l00141"></a>00141     retcode, output2=TimedCall.retry(3,300,[<span class="stringliteral">&apos;tar&apos;</span>, <span class="stringliteral">&apos;czf&apos;</span> , <span class="stringliteral">&apos;program.tar.gz&apos;</span>]+os.listdir(tempdir) )
<a name="l00142"></a>00142     <span class="keywordflow">if</span> retcode!=0:
<a name="l00143"></a>00143         log.error(<span class="stringliteral">&quot;Could not create a local copy check arguments!!&quot;</span>)
<a name="l00144"></a>00144         sys.exit(1)
<a name="l00145"></a>00145     user = options.user
<a name="l00146"></a>00146     path = <span class="stringliteral">&quot;srm://grid-srm.physik.rwth-aachen.de:8443/pnfs/physik.rwth-aachen.de/cms/store/user/%s/MUSiC/share/&quot;</span>%(user)
<a name="l00147"></a>00147     cmd1 = <span class="stringliteral">&quot;lcg-cp&quot;</span>
<a name="l00148"></a>00148     cmd2 = <span class="stringliteral">&quot;file:///%s/program.tar.gz&quot;</span>% (tempdir)
<a name="l00149"></a>00149     cmd3 = <span class="stringliteral">&quot;%sprogram.tar.gz&quot;</span>% (path)
<a name="l00150"></a>00150     command = [cmd1,cmd2,cmd3]
<a name="l00151"></a>00151     command2 = [<span class="stringliteral">&quot;uberftp&quot;</span>,<span class="stringliteral">&quot;grid-ftp.physik.rwth-aachen.de&quot;</span>,<span class="stringliteral">r&quot;rm /pnfs/physik.rwth-aachen.de/cms/store/user/%s/MUSiC/share/program.tar.gz&quot;</span>%(user)]
<a name="l00152"></a>00152     counter=0
<a name="l00153"></a>00153     log.debug( <span class="stringliteral">&quot; &quot;</span>.join(command2))
<a name="l00154"></a>00154     log.debug(<span class="stringliteral">&quot; &quot;</span>.join(command))
<a name="l00155"></a>00155     <span class="keywordflow">while</span> counter&lt;3:
<a name="l00156"></a>00156         retcode2, output2=TimedCall.retry( 3, 600, command2 )
<a name="l00157"></a>00157         retcode, output=TimedCall.retry( 3, 600, command )
<a name="l00158"></a>00158         <span class="keywordflow">if</span> retcode+retcode2==0:
<a name="l00159"></a>00159             <span class="keywordflow">break</span>
<a name="l00160"></a>00160         <span class="keywordflow">if</span> (retcode+retcode2)!=0:
<a name="l00161"></a>00161             log.info(<span class="stringliteral">&quot;Could not copy file to dcache&quot;</span>)
<a name="l00162"></a>00162             log.info(<span class="stringliteral">&quot; &quot;</span>.join(command2))
<a name="l00163"></a>00163             log.info(<span class="stringliteral">&quot; &quot;</span>.join(command))
<a name="l00164"></a>00164             log.info(output2)
<a name="l00165"></a>00165             log.info(output)
<a name="l00166"></a>00166     <span class="keywordflow">if</span> (retcode+retcode2)!=0:
<a name="l00167"></a>00167         log.info(<span class="stringliteral">&quot;Could not copy file to dcache&quot;</span>)
<a name="l00168"></a>00168         log.info(command2)
<a name="l00169"></a>00169         log.info(command)
<a name="l00170"></a>00170         log.info(output2)
<a name="l00171"></a>00171         log.info(output)
<a name="l00172"></a>00172         sys.exit(1)
<a name="l00173"></a>00173     log.info(<span class="stringliteral">&quot;File &quot;</span>+tempdir+<span class="stringliteral">&quot;/program.tar.gz  copied to dcache&quot;</span>)
<a name="l00174"></a>00174     os.chdir(thidir)
<a name="l00175"></a>00175 
<a name="l00176"></a>00176 
<a name="l00177"></a><a class="code" href="namespaceremote__example.html#aa0f5435ce8fa58d5e6ec5fc496adf3a4">00177</a> <span class="keyword">def </span><a class="code" href="namespaceremote__example.html#aa0f5435ce8fa58d5e6ec5fc496adf3a4">main</a>():
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     date_time = datetime.now()
<a name="l00180"></a>00180     usage = <span class="stringliteral">&apos;%prog [options] CONFIG_FILE&apos;</span>
<a name="l00181"></a>00181     parser = optparse.OptionParser( usage = usage )
<a name="l00182"></a>00182     parser.add_option( <span class="stringliteral">&apos;-u&apos;</span>, <span class="stringliteral">&apos;--user&apos;</span>, default = os.getenv( <span class="stringliteral">&apos;LOGNAME&apos;</span> ),
<a name="l00183"></a>00183                             help = <span class="stringliteral">&apos;which user on dcache [default = %s]&apos;</span>%(os.getenv( <span class="stringliteral">&apos;LOGNAME&apos;</span> )))
<a name="l00184"></a>00184     parser.add_option( <span class="stringliteral">&apos;-o&apos;</span>, <span class="stringliteral">&apos;--Output&apos;</span>, default = <span class="stringliteral">&apos;%s&apos;</span>%(binConfig.outDir).replace(<span class="stringliteral">&quot;USER&quot;</span>,os.getlogin())+<span class="stringliteral">&quot;/TAG&quot;</span>, metavar = <span class="stringliteral">&apos;DIRECTORY&apos;</span>,
<a name="l00185"></a>00185                             help = <span class="stringliteral">&apos;Define the output directory. [default = %default]&apos;</span>)
<a name="l00186"></a>00186     parser.add_option( <span class="stringliteral">&apos;-f&apos;</span>, <span class="stringliteral">&apos;--force&apos;</span>, default = <span class="stringliteral">&quot;force the output to overwrite&quot;</span>, metavar = <span class="stringliteral">&apos;DIRECTORY&apos;</span>,
<a name="l00187"></a>00187                             help = <span class="stringliteral">&apos;Define the output directory. [default = %default]&apos;</span>)
<a name="l00188"></a>00188     parser.add_option( <span class="stringliteral">&apos;--debug&apos;</span>, metavar = <span class="stringliteral">&apos;LEVEL&apos;</span>, default = <span class="stringliteral">&apos;INFO&apos;</span>,
<a name="l00189"></a>00189                        help= <span class="stringliteral">&apos;Set the debug level. Allowed values: ERROR, WARNING, INFO, DEBUG. [default = %default]&apos;</span> )
<a name="l00190"></a>00190     parser.add_option( <span class="stringliteral">&apos;-t&apos;</span>, <span class="stringliteral">&apos;--Tag&apos;</span>, default = <span class="stringliteral">&quot;output%s_%s_%s_%s_%s&quot;</span>%(date_time.year,
<a name="l00191"></a>00191                                                                         date_time.month,
<a name="l00192"></a>00192                                                                         date_time.day,
<a name="l00193"></a>00193                                                                         date_time.hour,
<a name="l00194"></a>00194                                                                         date_time.minute), metavar = <span class="stringliteral">&apos;DIRECTORY&apos;</span>,
<a name="l00195"></a>00195                         help = <span class="stringliteral">&apos;Define a Tag for the output directory. [default = %default]&apos;</span> )
<a name="l00196"></a>00196 
<a name="l00197"></a>00197     ( options, args ) = parser.parse_args()
<a name="l00198"></a>00198     <span class="keywordflow">if</span> len( args ) != 1:
<a name="l00199"></a>00199         parser.error( <span class="stringliteral">&apos;Exactly one CONFIG_FILE required!&apos;</span> )
<a name="l00200"></a>00200     options.Output=options.Output.replace(<span class="stringliteral">&quot;TAG&quot;</span>,options.Tag)
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 
<a name="l00203"></a>00203     format = <span class="stringliteral">&apos;%(levelname)s from %(name)s at %(asctime)s: %(message)s&apos;</span>
<a name="l00204"></a>00204     date = <span class="stringliteral">&apos;%F %H:%M:%S&apos;</span>
<a name="l00205"></a>00205     logging.basicConfig( level = logging._levelNames[ options.debug ], format = format, datefmt = date )
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a>00208     <span class="keywordflow">try</span>:
<a name="l00209"></a>00209        cmssw_version, cmssw_base, scram_arch = checkEnvironment.checkEnvironment()
<a name="l00210"></a>00210     <span class="keywordflow">except</span> EnvironmentError, err:
<a name="l00211"></a>00211         log.error( err )
<a name="l00212"></a>00212         log.info( <span class="stringliteral">&apos;Exiting...&apos;</span> )
<a name="l00213"></a>00213         sys.exit( err.errno )
<a name="l00214"></a>00214 
<a name="l00215"></a>00215 
<a name="l00216"></a>00216     cfgFile = args[ 0 ]
<a name="l00217"></a>00217     sampleList=getFilesfromFile(cfgFile)
<a name="l00218"></a>00218     prepare_teli(options)
<a name="l00219"></a>00219     makeExe(options.user)
<a name="l00220"></a>00220 
<a name="l00221"></a>00221     thisdir=os.getcwd()
<a name="l00222"></a>00222     <span class="keywordflow">if</span> os.path.exists(options.Output) <span class="keywordflow">or</span> <span class="keywordflow">not</span> options.force:
<a name="l00223"></a>00223         log.error(<span class="stringliteral">&quot;The outpath &quot;</span>+options.Output+<span class="stringliteral">&quot; already exists pick a new one or use --force&quot;</span>)
<a name="l00224"></a>00224         sys.exit(3)
<a name="l00225"></a>00225     <span class="keywordflow">else</span>:
<a name="l00226"></a>00226         os.makedirs(options.Output)
<a name="l00227"></a>00227     shutil.copyfile(thisdir+<span class="stringliteral">&quot;/runtemp.sh&quot;</span>,options.Output+<span class="stringliteral">&quot;/runtemp.sh&quot;</span>)
<a name="l00228"></a>00228     os.remove(thisdir+<span class="stringliteral">&quot;/runtemp.sh&quot;</span>)
<a name="l00229"></a>00229 
<a name="l00230"></a>00230     <span class="keywordflow">for</span> sample <span class="keywordflow">in</span> sampleList:
<a name="l00231"></a>00231         task=cesubmit.Task(sample,options.Output+<span class="stringliteral">&quot;/&quot;</span>+sample,scramArch=<span class="stringliteral">&apos;slc6_amd64_gcc481&apos;</span>, cmsswVersion=<span class="stringliteral">&apos;CMSSW_7_0_7_patch1&apos;</span>)
<a name="l00232"></a>00232 
<a name="l00233"></a>00233         task.executable=options.Output+<span class="stringliteral">&quot;/runtemp.sh&quot;</span>
<a name="l00234"></a>00234         task.inputfiles=[]
<a name="l00235"></a>00235         task.outputfiles=[<span class="stringliteral">&quot;MusicOutDir.tar.gz&quot;</span>]
<a name="l00236"></a>00236 
<a name="l00237"></a>00237         <span class="comment">#usage: bin/music [--DumpECHistos] [--NoSpecialAna] [--NoCcControl] [--NoCcEventClass] [-h] [-o value] [-N value] [-x value] [-p value] [--debug value] [-M value] a1...</span>
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 
<a name="l00240"></a>00240         standardArg=[<span class="stringliteral">&quot;--NoCcControl&quot;</span>, <span class="stringliteral">&quot;--NoCcEventClass&quot;</span>,<span class="stringliteral">&quot;--ECMerger&quot;</span>,<span class="stringliteral">&quot;2&quot;</span>,<span class="stringliteral">&quot;-o&quot;</span>,<span class="stringliteral">&quot;MusicOutDir&quot;</span>,sampleList[sample][1]]
<a name="l00241"></a>00241         <span class="keywordflow">print</span> <span class="stringliteral">&quot;down under&quot;</span>
<a name="l00242"></a>00242         <span class="keywordflow">for</span> f <span class="keywordflow">in</span> sampleList[sample][0]:
<a name="l00243"></a>00243             <span class="keywordflow">print</span> f
<a name="l00244"></a>00244             job=cesubmit.Job()
<a name="l00245"></a>00245             job.arguments=standardArg+f
<a name="l00246"></a>00246             task.addJob(job)
<a name="l00247"></a>00247         log.info(<span class="stringliteral">&quot;start submitting&quot;</span>)
<a name="l00248"></a>00248         task.submit(6)
<a name="l00249"></a>00249 
<a name="l00250"></a>00250 
<a name="l00251"></a>00251     log.info(<span class="stringliteral">&quot;Thanks for zapping in, bye bye&quot;</span>)
<a name="l00252"></a>00252     log.info(<span class="stringliteral">&quot;The out files will be in &quot;</span>+options.Output)
<a name="l00253"></a>00253 
<a name="l00254"></a>00254 
<a name="l00255"></a>00255 
<a name="l00256"></a>00256 <span class="keywordflow">if</span> __name__ == <span class="stringliteral">&apos;__main__&apos;</span>:
<a name="l00257"></a>00257     main()
</pre></div></div>
<!-- HTML footer for doxygen 1.8.5-->
<!-- start footer part -->
<!--BEGIN GENERATE_TREEVIEW-->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    $navpath
    <li class="footer">
      libs3a is part of TAPAS check out all parts of it on 
      <a href="https://github.com/Aachen-3A/TAPAS">github</a>.
      Documentation $generatedby
    <a href="http://www.doxygen.org/index.html">
    <img class="footer" src="$relpath^doxygen.png" alt="doxygen"/></a> 1.6.1 </li>
  </ul>

</div>
<!--END GENERATE_TREEVIEW-->
<!--BEGIN !GENERATE_TREEVIEW-->
<hr class="footer"/><address class="footer"><small>

$generatedby &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="$relpath^doxygen.png" alt="doxygen"/>
</a> 1.6.1
</small></address>
<!--END !GENERATE_TREEVIEW-->
</body>
</html>
